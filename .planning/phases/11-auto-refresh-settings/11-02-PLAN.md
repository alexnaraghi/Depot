---
phase: 11-auto-refresh-settings
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/components/SettingsDialog.tsx
  - src-tauri/Cargo.toml
  - src-tauri/capabilities/default.json
  - src-tauri/src/lib.rs
autonomous: true

must_haves:
  truths:
    - "User can configure external editor path in settings dialog"
    - "User can browse for editor executable using native file picker"
    - "User can configure auto-refresh interval in settings dialog"
    - "User can disable auto-refresh by setting interval to 0"
    - "Settings dialog shows current saved values for new fields"
  artifacts:
    - path: "src/components/SettingsDialog.tsx"
      provides: "Editor path field with Browse button, auto-refresh interval selector"
      contains: "editorPath"
    - path: "src-tauri/Cargo.toml"
      provides: "tauri-plugin-dialog dependency"
      contains: "tauri-plugin-dialog"
  key_links:
    - from: "src/components/SettingsDialog.tsx"
      to: "@tauri-apps/plugin-dialog"
      via: "open() for native file picker"
      pattern: "plugin-dialog"
    - from: "src/components/SettingsDialog.tsx"
      to: "src/types/settings.ts"
      via: "P4Settings type with editorPath and autoRefreshInterval fields"
      pattern: "editorPath.*autoRefreshInterval"
---

<objective>
Install the Tauri dialog plugin and extend the SettingsDialog UI with editor path configuration (including native file Browse button) and auto-refresh interval settings.

Purpose: This completes Phase 11 by giving users a UI to configure the auto-refresh interval and external editor path. Without this, users would be stuck with defaults.
Output: Updated SettingsDialog with two new sections, native file picker integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-auto-refresh-settings/11-RESEARCH.md
@.planning/phases/11-auto-refresh-settings/11-01-SUMMARY.md
@src/components/SettingsDialog.tsx
@src/types/settings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Tauri dialog plugin</name>
  <files>src-tauri/Cargo.toml, src-tauri/capabilities/default.json, src-tauri/src/lib.rs</files>
  <action>
    Run `npm run tauri add dialog` from the project root. This command:
    - Adds `tauri-plugin-dialog` to Cargo.toml dependencies
    - Adds `"dialog:default"` to capabilities/default.json permissions
    - Registers the plugin in lib.rs via `.plugin(tauri_plugin_dialog::init())`

    After running, verify:
    1. `src-tauri/Cargo.toml` contains `tauri-plugin-dialog`
    2. `src-tauri/capabilities/default.json` includes dialog permissions
    3. `src-tauri/src/lib.rs` has `.plugin(tauri_plugin_dialog::init())`

    Also install the JS package: `npm install @tauri-apps/plugin-dialog`

    If `npm run tauri add dialog` doesn't handle all three, manually add:
    - Cargo.toml: `tauri-plugin-dialog = "2"` under `[dependencies]`
    - capabilities/default.json: add `"dialog:default"` to permissions array
    - lib.rs: add `.plugin(tauri_plugin_dialog::init())` in the plugin chain
  </action>
  <verify>`cargo check` in src-tauri/ succeeds. `npm ls @tauri-apps/plugin-dialog` shows the package installed.</verify>
  <done>tauri-plugin-dialog installed on both Rust and JS sides, registered in app capabilities and plugin chain.</done>
</task>

<task type="auto">
  <name>Task 2: Add editor path and auto-refresh interval to SettingsDialog</name>
  <files>src/components/SettingsDialog.tsx</files>
  <action>
    Extend SettingsDialog.tsx to include two new sections after the existing "Logging" section:

    1. **Add import** for dialog plugin: `import { open } from '@tauri-apps/plugin-dialog';`

    2. **Update form defaultValues** to include `editorPath: ''` and `autoRefreshInterval: 300000`

    3. **Update the load condition** in the useEffect that checks for saved settings — add `|| settings.editorPath || settings.autoRefreshInterval` to the condition so new fields trigger form reset too. Actually, `autoRefreshInterval` defaults to 300000 which is truthy, so it will always reset — which is fine.

    4. **Add "External Editor" section** after the Logging section (before DialogFooter):
    ```
    <div className="border-t border-border pt-4 mt-2">
      <h3 className="text-sm font-medium text-foreground mb-3">External Editor</h3>
      <FormField for "editorPath">
        - Label: "Editor Path"
        - Input with placeholder "code, notepad++, /path/to/editor"
        - Browse button next to input that calls:
          const selected = await open({
            multiple: false,
            directory: false,
            filters: [{ name: 'Executable', extensions: ['exe'] }]
          });
          if (selected) field.onChange(selected as string);
        - Helper text: "Path to external text editor (e.g., code, notepad++, or full path)"
      </FormField>
    </div>
    ```
    Use the same flex layout pattern as the workspace Browse button (div with flex gap-2, input flex-1, button).

    5. **Add "Auto-Refresh" section** after Editor section:
    ```
    <div className="border-t border-border pt-4 mt-2">
      <h3 className="text-sm font-medium text-foreground mb-3">Auto-Refresh</h3>
      <FormField for "autoRefreshInterval">
        - Label: "Refresh Interval"
        - Use a <Select> dropdown with preset options instead of raw number input:
          - "Disabled" → value 0
          - "30 seconds" → value 30000
          - "1 minute" → value 60000
          - "2 minutes" → value 120000
          - "5 minutes" → value 300000 (default)
          - "10 minutes" → value 600000
        - onValueChange converts string to number: field.onChange(parseInt(value, 10))
        - Display current value by finding matching option or defaulting to "5 minutes"
        - Helper text: "Automatically refresh workspace state. Pauses during operations and when window is minimized."
      </FormField>
    </div>
    ```
    Use the existing Select/SelectContent/SelectItem/SelectTrigger/SelectValue components already imported in this file.

    IMPORTANT: The Select component value must be a string, so convert number to string for value prop and string to number in onValueChange.
  </action>
  <verify>`npx tsc --noEmit` passes. Launch app with `npm run tauri dev`, open Settings dialog, verify new Editor and Auto-Refresh sections appear with correct controls. Browse button opens native file picker. Auto-refresh dropdown shows preset intervals.</verify>
  <done>Settings dialog has Editor Path field with Browse button and Auto-Refresh interval dropdown. Values persist across dialog open/close. Browse button opens native OS file picker filtered to executables.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. App builds and runs: `npm run tauri dev`
3. Settings dialog shows Editor Path field with Browse button
4. Browse button opens native Windows file picker
5. Settings dialog shows Auto-Refresh dropdown with preset intervals
6. Selecting "Disabled" stops auto-refresh
7. Selecting "5 minutes" enables auto-refresh at 5-minute interval
8. All settings values persist after saving and reopening dialog
</verification>

<success_criteria>
- Tauri dialog plugin installed and working
- Settings dialog has Editor Path field with native file picker Browse button
- Settings dialog has Auto-Refresh interval dropdown with preset options
- User can disable auto-refresh by selecting "Disabled"
- All new settings persist correctly via tauri-plugin-store
</success_criteria>

<output>
After completion, create `.planning/phases/11-auto-refresh-settings/11-02-SUMMARY.md`
</output>
