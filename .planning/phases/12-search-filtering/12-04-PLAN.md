---
phase: 12-search-filtering
plan: 04
type: execute
wave: 3
depends_on: ["12-02", "12-03"]
files_modified:
  - src/components/SearchBar.tsx
  - src/components/FileTree/FileTree.tsx
  - src/components/ChangelistPanel/ChangelistPanel.tsx
  - src/components/DetailPane/SearchResultsView.tsx
autonomous: false

must_haves:
  truths:
    - "Clicking a search result in filtered columns dismisses the filter and restores normal view"
    - "Filtered columns show subtle background tint when filter is active"
    - "All Phase 12 success criteria pass visual inspection"
  artifacts: []
  key_links:
    - from: "src/components/FileTree/FileNode.tsx"
      to: "src/stores/searchFilterStore.ts"
      via: "clearFilter on click"
      pattern: "clearFilter"
---

<objective>
Polish the search filtering experience: add background tint to filtered columns, wire result-click-dismisses-filter behavior, and visually verify all Phase 12 success criteria.

Purpose: Ensures the filtering UX is polished and all phase success criteria are met.
Output: Polished search filtering with visual verification.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-search-filtering/12-02-SUMMARY.md
@.planning/phases/12-search-filtering/12-03-SUMMARY.md
@src/stores/searchFilterStore.ts
@src/components/SearchBar.tsx
@src/components/FileTree/FileTree.tsx
@src/components/ChangelistPanel/ChangelistPanel.tsx
@src/components/MainLayout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add filter-active tint, result-click dismiss, and polish</name>
  <files>src/components/FileTree/FileTree.tsx, src/components/ChangelistPanel/ChangelistPanel.tsx, src/components/SearchBar.tsx, src/components/MainLayout.tsx</files>
  <action>
    1. **Background tint on filtered columns:**
       - In `FileTree.tsx`: When `isActive` from searchFilterStore is true, add a subtle background tint to the file tree container: `bg-blue-950/20` (very subtle blue tint) as an additional class on the outer div.
       - In `ChangelistPanel.tsx`: Same treatment — add `bg-blue-950/20` when filter is active.
       - This provides visual feedback that columns are currently filtered.

    2. **Result-click dismisses filter:**
       - In `FileNode.tsx`: When a matching (non-dimmed) file is clicked and filter is active, call `useSearchFilterStore.getState().clearFilter()` AFTER the detail pane navigation (selectFile). This restores the unfiltered view and lets the user see the file in context.
       - In `ChangelistNode.tsx`: Same behavior for changelist items — clicking a matching CL clears the filter after navigation.
       - Per CONTEXT.md: "Clicking a search result navigates to it in detail pane AND dismisses the filter"

    3. **Search bar collapse behavior:**
       - Per CONTEXT.md: "Search bar minimizes/collapses when a result is clicked or filter is cancelled"
       - When filter is cleared (either by clicking a result or pressing Escape with empty text): the search input should collapse back to a compact state. Add a `isCollapsed` state to SearchBar that defaults to true. When user clicks the search icon or presses Ctrl+F, expand to show full input. When filter is cleared via external action (store subscription), collapse again.
       - Or simpler: keep the input always visible but make it narrower when not focused/empty. The CONTEXT.md says "minimizes/collapses" which can mean just making it compact (icon-only) vs expanded (full input). Reuse the current expand/collapse pattern from the original SearchBar but driven by the store's `isActive` state.

    4. **Final cleanup:**
       - Ensure no console.log debug statements remain
       - Verify all TypeScript types are clean
       - Ensure Escape key behavior works correctly end-to-end: clear text -> unfocus -> collapse
  </action>
  <verify>
    - `npm run build` succeeds
    - Filtered columns show blue tint
    - Clicking a matching item dismisses filter and navigates to detail
    - Search bar collapses when filter cleared
  </verify>
  <done>Filter-active visual tint applied to both columns. Result clicks dismiss filter. Search bar collapse behavior works.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 12 search filtering: in-place fuzzy filtering of file tree and changelist columns, command palette deep searches, match highlighting, and visual polish.</what-built>
  <how-to-verify>
    1. Launch the app with `npm run tauri dev`
    2. **In-place filtering:**
       - Click the search bar or press Ctrl+F
       - Type a partial file name (e.g., "main" or "store")
       - Verify: non-matching files in left column are dimmed, matching files have highlighted characters
       - Verify: non-matching changelists/files in right column are dimmed
       - Verify: match count badge shows total matches near search bar
       - Verify: both columns show subtle blue tint while filter is active
    3. **Result click dismiss:**
       - Click a matching (non-dimmed) file in the left column
       - Verify: filter clears, all items restore to normal, detail pane shows file detail
    4. **Escape behavior:**
       - Type something in search, press Escape
       - Verify: text clears first press, input blurs/collapses second press
    5. **Command palette deep search:**
       - Press Ctrl+K to open command palette
       - Type "search" to find search commands
       - Select "Search Submitted Changelists"
       - Verify: detail pane shows search input + results
       - Type a search term and verify results appear
       - Select "Search Depot Paths" and verify depot search works
    6. **Edge cases:**
       - Filter with no matches: both columns fully dimmed, badge shows "0 matches"
       - Very fast typing: no jank or freezing (useDeferredValue smooths it)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
All Phase 12 success criteria from ROADMAP.md:
1. ✓ Typing in toolbar search filters file tree (left column) and changelists (right column) in-place
2. ✓ Filtered columns show match count badges and subtle background tint
3. ✓ Pressing Escape or clearing search restores unfiltered state
4. ✓ Command palette provides "Search submitted changelists" and "Search depot" for deep searches
</verification>

<success_criteria>
- All four ROADMAP success criteria verified by human
- No visual bugs or interaction issues
- Performance acceptable with real workspace data
</success_criteria>

<output>
After completion, create `.planning/phases/12-search-filtering/12-04-SUMMARY.md`
</output>
