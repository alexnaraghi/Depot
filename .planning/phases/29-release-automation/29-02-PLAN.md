---
phase: 29-release-automation
plan: 02
type: execute
wave: 2
depends_on: ["29-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Workflow triggers successfully from GitHub UI"
    - "Build completes without errors"
    - "Draft GitHub Release is created"
    - "Release contains both NSIS and MSI installers"
    - "Release is marked as pre-release (v0.x)"
  artifacts:
    - path: "GitHub Release (external)"
      provides: "Draft release with installers"
      contains: "depot_0.1.0_x64-setup.exe, depot_0.1.0_x64_en-US.msi"
  key_links:
    - from: "GitHub Actions workflow"
      to: "GitHub Releases"
      via: "tauri-action creates release"
      pattern: "N/A (external verification)"
---

<objective>
Verify release workflow by triggering manual build and confirming GitHub Release creation

Purpose: Validate that the release automation works before relying on it for public launch
Output: Confirmed working release workflow with draft release containing installers
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-release-automation/29-01-SUMMARY.md

# Workflow file created in previous plan
@.github/workflows/publish.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Push workflow to remote</name>
  <files></files>
  <action>
Commit and push the workflow file and CONTRIBUTING.md updates to the remote repository.

**Git operations:**
1. Stage the new/modified files:
   - `.github/workflows/publish.yml`
   - `CONTRIBUTING.md`
2. Commit with message: `ci(29): add release automation workflow`
3. Push to remote (origin master)

**Important:** The workflow must be pushed to the default branch before it can be triggered via the GitHub UI.

If the repository has no remote configured or push fails, note this for the checkpoint task.
  </action>
  <verify>
1. Git log shows commit: `git log -1 --oneline`
2. Push successful: no error output from `git push`
3. Or note failure reason for checkpoint
  </verify>
  <done>
- Workflow file committed and pushed to remote
- OR failure reason documented for checkpoint resolution
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Release automation workflow pushed to GitHub. Ready for manual trigger test.
  </what-built>
  <how-to-verify>
**Step 1: Navigate to GitHub Actions**
1. Go to your repository on GitHub (should be github.com/[username]/p4now or depot)
2. Click the **Actions** tab
3. Look for **Release** workflow in the left sidebar
4. If workflow doesn't appear, wait 30 seconds and refresh (GitHub caches workflow list)

**Step 2: Trigger the workflow**
1. Click on **Release** workflow
2. Click **Run workflow** dropdown button (right side)
3. Ensure **Branch: master** is selected
4. Click green **Run workflow** button
5. Wait for workflow to start (refresh page if needed)

**Step 3: Monitor build progress**
1. Click on the running workflow to see details
2. Expand the **publish-tauri** job to see step-by-step progress
3. Build takes approximately 10-15 minutes (Rust compilation is slow)
4. Watch for any red X failures

**Step 4: Verify Release created**
1. Navigate to **Releases** page (Code tab → Releases section on right, or /releases URL)
2. Find the draft release titled "Depot v0.1.0"
3. Verify it has:
   - Pre-release badge (yellow label)
   - Draft badge (gray label)
   - Assets section with:
     - `depot_0.1.0_x64-setup.exe` (NSIS installer)
     - `depot_0.1.0_x64_en-US.msi` (MSI installer)
     - Source code archives (automatic)

**Troubleshooting:**
- If workflow fails at "Resource not accessible" → Check repo Settings → Actions → Workflow permissions → Enable "Read and write permissions"
- If workflow doesn't appear → Ensure commit was pushed to master branch
- If build fails → Check error logs in the failed step

**Expected artifacts:**
- depot_0.1.0_x64-setup.exe (~3-5 MB)
- depot_0.1.0_x64_en-US.msi (~3-5 MB)
  </how-to-verify>
  <resume-signal>
Type one of:
- "approved" - workflow succeeded, release created with both installers
- "failed: [reason]" - describe what went wrong for debugging
  </resume-signal>
</task>

</tasks>

<verification>
This plan's success is verified by the human checkpoint task.

**Success indicators:**
1. GitHub Actions workflow completes with green checkmark
2. Draft release exists at repository's Releases page
3. Release contains both .exe and .msi installers
4. Release has "Pre-release" badge

**If verification fails:**
- Note the specific error or missing element
- May require 29-03 plan to fix workflow issues
</verification>

<success_criteria>
- [ ] Workflow file pushed to remote repository
- [ ] Manual workflow trigger works from GitHub UI
- [ ] Build completes successfully (~10-15 min)
- [ ] Draft GitHub Release created automatically
- [ ] Release contains depot_0.1.0_x64-setup.exe (NSIS)
- [ ] Release contains depot_0.1.0_x64_en-US.msi (MSI)
- [ ] Release marked as pre-release (v0.x detection working)
- [ ] Requirement DIST-04 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/29-release-automation/29-02-SUMMARY.md`
</output>
