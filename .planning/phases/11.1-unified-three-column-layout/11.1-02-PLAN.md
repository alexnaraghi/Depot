---
phase: 11.1-unified-three-column-layout
plan: 02
type: execute
wave: 2
depends_on: ["11.1-01"]
files_modified:
  - src/components/DetailPane/WorkspaceSummaryView.tsx
  - src/components/DetailPane/FileDetailView.tsx
  - src/components/DetailPane/DetailPane.tsx
autonomous: true

must_haves:
  truths:
    - "When nothing is selected, detail pane shows workspace summary with file count, CL count, and last sync info"
    - "When a file is selected, detail pane shows file info, action buttons, and inline revision history"
    - "Clicking a history row in file detail drills into revision detail (selection store update)"
  artifacts:
    - path: "src/components/DetailPane/WorkspaceSummaryView.tsx"
      provides: "Dashboard view with workspace stats"
    - path: "src/components/DetailPane/FileDetailView.tsx"
      provides: "File info, actions, inline history table"
  key_links:
    - from: "src/components/DetailPane/FileDetailView.tsx"
      to: "src/hooks/useFileHistory.ts"
      via: "useFileHistory(depotPath) for inline history"
    - from: "src/components/DetailPane/FileDetailView.tsx"
      to: "src/stores/detailPaneStore.ts"
      via: "drillToRevision on history row click"
---

<objective>
Build the WorkspaceSummaryView and FileDetailView components that render inside the detail pane.

Purpose: These are the two most-used detail views. The workspace summary is the default state, and file detail is shown whenever a file is clicked anywhere in the app.
Output: Two fully functional detail views wired into the DetailPane component.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/design/unified-column-layout.md
@.planning/phases/11.1-unified-three-column-layout/11.1-01-SUMMARY.md
@src/stores/detailPaneStore.ts
@src/hooks/useFileHistory.ts
@src/hooks/useFileOperations.ts
@src/hooks/useDiff.ts
@src/components/dialogs/FileHistoryDialog.tsx
@src/types/p4.ts
@src/lib/tauri.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WorkspaceSummaryView</name>
  <files>src/components/DetailPane/WorkspaceSummaryView.tsx</files>
  <action>
Create a dashboard view shown when nothing is selected. Follow the design doc layout:

```
WORKSPACE SUMMARY

3 files checked out
2 pending changelists
Last sync: 5 min ago (#4520)
```

**Data sources:**
- File count: Use TanStack Query to read from the existing `['p4', 'opened']` query cache via `useQueryClient().getQueryData(['p4', 'opened'])` or use `useQuery` with the same key. The opened files query returns P4File[]. Show `files.length` as "X files checked out".
- Changelist count: Read from `['p4', 'changes']` query cache. Show count of pending CLs.
- Last sync: This data isn't readily available from existing queries. Show "Connected to {workspace}" instead, reading from useConnectionStore.

**Layout:**
- Use a centered layout with generous padding (p-8)
- Title: "Workspace Summary" in text-lg font-semibold
- Stats as a simple list with icons (FileEdit for files, GitBranch for CLs, Wifi for connection)
- Use muted colors for a subtle dashboard feel
- Add the workspace name and stream from useConnectionStore

Keep it simple — no charts, no complex layouts. This is a landing page, not a dashboard.
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>WorkspaceSummaryView renders workspace stats from existing query cache and connection store.</done>
</task>

<task type="auto">
  <name>Task 2: Create FileDetailView with inline history</name>
  <files>src/components/DetailPane/FileDetailView.tsx, src/components/DetailPane/DetailPane.tsx</files>
  <action>
Create the file detail view following the design doc:

```
engine.cpp
#42 - edit - 2.3KB
---
ACTIONS: [Diff] [Checkout] [Revert] [Open] [Open in Explorer]
---
HISTORY
#42  alice  Jan 30  "Fix null deref in render loop"
#41  bob    Jan 28  "Add shadow pass"
---
PROPERTIES
Type: text    Depot: //depot/src/engine/engine.cpp
Workspace: C:\src\engine\engine.cpp
```

**Props:** Receive `depotPath: string` and `localPath: string` from DetailPane (read from selection store).

**File info section:**
- Extract filename from depotPath (split on '/')
- Look up file from fileTreeStore to get revision, action, fileType
- Show revision number, action badge (reuse the same color scheme from FileHistoryDialog), and file type

**Action buttons row:**
- [Diff] — call `useDiff().diffAgainstWorkspace(depotPath, localPath, revision)`
- [Checkout] — call `useFileOperations().checkout([depotPath])`
- [Revert] — call `useFileOperations().revert([depotPath])`
- [Open in Explorer] — use Tauri's `invoke('plugin:opener|open_path', { path: localPath })` or `import { open } from '@tauri-apps/plugin-opener'` to open containing folder. If opener plugin not available, skip this button for now and add a TODO comment.
- Use Button components with variant="outline" and size="sm", arranged in a flex row with gap-2
- Conditionally show buttons based on file state (e.g., don't show "Checkout" if file is already checked out)

**Inline history table:**
- Use `useFileHistory(depotPath)` hook — it already handles pagination with loadMore
- Render as a table matching FileHistoryDialog's format but embedded (not in a dialog)
- Columns: Rev, Action (with color badge), Date, User, Description
- Each row is clickable: on click, call `useDetailPaneStore.getState().drillToRevision(depotPath, localPath, revision)` to navigate to revision detail view
- Add hover state on rows to indicate clickability
- Show "Load More" button at bottom if hasMore is true

**Properties section:**
- File type, depot path, workspace path in a simple grid layout
- Use text-sm text-muted-foreground for labels, text-foreground for values

**Update DetailPane.tsx:**
- Replace the file placeholder with `<FileDetailView depotPath={selection.depotPath} localPath={selection.localPath} />`
- Replace the none placeholder with `<WorkspaceSummaryView />`
- Keep changelist and revision as placeholders for now
  </action>
  <verify>`npx tsc --noEmit` passes. Run `npm run dev` and manually set store state in console: `window.__detailPaneStore?.getState().selectFile('//depot/test.cpp', 'C:\\test.cpp')` to verify file detail view renders (if store is exposed).</verify>
  <done>FileDetailView shows file info, action buttons, inline history table, and properties. History rows are clickable and drill into revision detail. WorkspaceSummaryView renders in default state. DetailPane switches between views based on selection.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. DetailPane shows WorkspaceSummaryView when selection is 'none'
3. DetailPane shows FileDetailView when selection is 'file'
4. FileDetailView displays file metadata, action buttons, and history table
5. History rows in FileDetailView are clickable and update selection store to revision type
</verification>

<success_criteria>
WorkspaceSummaryView shows workspace stats. FileDetailView shows file info with inline history that loads lazily. Clicking history row updates selection store to revision type.
</success_criteria>

<output>
After completion, create `.planning/phases/11.1-unified-three-column-layout/11.1-02-SUMMARY.md`
</output>
