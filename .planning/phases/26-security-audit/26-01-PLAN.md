---
phase: 26-security-audit
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/26-security-audit/26-01-gitleaks-report.json
  - .planning/phases/26-security-audit/26-01-trufflehog-report.json
autonomous: true

must_haves:
  truths:
    - "Gitleaks scan of entire Git history completes with zero verified credential detections"
    - "TruffleHog comprehensive audit confirms no verified secrets in repository"
    - "All flagged items are documented and triaged as false positives or actionable"
  artifacts:
    - path: ".planning/phases/26-security-audit/26-01-gitleaks-report.json"
      provides: "Gitleaks scan results for all 521 commits"
    - path: ".planning/phases/26-security-audit/26-01-trufflehog-report.json"
      provides: "TruffleHog scan results for full repository"
  key_links:
    - from: "git history"
      to: "scan reports"
      via: "gitleaks detect --source . --report-format json"
      pattern: "no verified secrets"
---

<objective>
Run automated security scanning tools on entire Git history to detect any credentials, API keys, or secrets that would be exposed when repository becomes public.

Purpose: BLOCKING requirement for v6.0 - credentials in Git history cannot be unpublished after repo is public
Output: JSON reports from Gitleaks and TruffleHog confirming zero verified secrets
</objective>

<execution_context>
@C:\Users\a\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\a\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and run Gitleaks on full Git history</name>
  <files>.planning/phases/26-security-audit/26-01-gitleaks-report.json</files>
  <action>
    Install Gitleaks via one of these methods (try in order):
    1. `go install github.com/gitleaks/gitleaks/v8@latest` (if Go installed)
    2. Download Windows binary from https://github.com/gitleaks/gitleaks/releases/latest
    3. `npx gitleaks-secret-scanner` as fallback

    Run Gitleaks scan on full Git history:
    ```
    gitleaks detect --source . --report-format json --report-path .planning/phases/26-security-audit/26-01-gitleaks-report.json --log-level info
    ```

    Key flags:
    - `--source .` scans current repo including full git history
    - `--report-format json` for parseable output
    - No `--no-git` flag (we want full history scan)

    Expected outcome: Exit code 0 with empty findings array, or exit code 1 with findings to triage.

    If findings exist, document each one with:
    - File path and line number
    - Secret type detected
    - Whether it's a false positive (example data, test fixtures) or real credential
    - Remediation needed if real
  </action>
  <verify>
    Run: `gitleaks detect --source . --no-git --verbose 2>&1 | head -20`
    Check: No "leaks found" message for actual credentials (false positives acceptable if documented)
    Check: Report file exists at .planning/phases/26-security-audit/26-01-gitleaks-report.json
  </verify>
  <done>
    Gitleaks scan completes with zero verified credential findings (false positives documented if any)
  </done>
</task>

<task type="auto">
  <name>Task 2: Install and run TruffleHog for verification</name>
  <files>.planning/phases/26-security-audit/26-01-trufflehog-report.json</files>
  <action>
    Install TruffleHog via one of these methods (try in order):
    1. `pip install trufflehog` or `pipx install trufflehog`
    2. Download binary from https://github.com/trufflesecurity/trufflehog/releases/latest
    3. `docker run --rm -v "$(pwd):/pwd" trufflesecurity/trufflehog:latest git file:///pwd`

    Run TruffleHog scan on repository:
    ```
    trufflehog git file://. --json --only-verified 2>&1 | tee .planning/phases/26-security-audit/26-01-trufflehog-report.json
    ```

    Key flags:
    - `git file://.` scans local git repo
    - `--json` for parseable output
    - `--only-verified` focuses on confirmed secrets (reduces false positives)

    Alternative if trufflehog unavailable:
    ```
    trufflehog filesystem . --json 2>&1 | tee .planning/phases/26-security-audit/26-01-trufflehog-report.json
    ```

    TruffleHog complements Gitleaks with different detection patterns and verification capabilities.
    Document any findings similar to Task 1.
  </action>
  <verify>
    Run: `cat .planning/phases/26-security-audit/26-01-trufflehog-report.json | head -20`
    Check: Empty JSON or only unverified/false positive entries
    Check: No verified secrets in output
  </verify>
  <done>
    TruffleHog scan completes with zero verified secrets, confirming Gitleaks results
  </done>
</task>

<task type="auto">
  <name>Task 3: Triage and document scan results</name>
  <files>.planning/phases/26-security-audit/26-01-SUMMARY.md</files>
  <action>
    Consolidate findings from both scans into summary:

    1. Parse Gitleaks report:
       - Count total findings
       - Categorize by RuleID (generic-api-key, private-key, etc.)
       - Mark each as: FALSE_POSITIVE (example data), EXCLUDED (test fixtures), or ACTION_NEEDED

    2. Parse TruffleHog report:
       - Note any verified vs unverified findings
       - Cross-reference with Gitleaks findings

    3. For any ACTION_NEEDED items:
       - Document the exact file/line/commit
       - Determine if secret is still active (needs rotation)
       - Determine if git history rewrite needed (BFG Repo-Cleaner)

    4. Document known false positives in this codebase:
       - `ssl:perforce.example.com:1666` - example placeholder in research docs
       - Any test fixture data
       - React Prism token variables (syntax highlighting, not secrets)

    If zero ACTION_NEEDED items: Repository is clear for public release.
    If any ACTION_NEEDED items: Document remediation steps, BLOCK Phase 27.
  </action>
  <verify>
    Read summary file and confirm:
    - All findings triaged
    - Clear pass/fail determination
    - If fail, remediation steps documented
  </verify>
  <done>
    Scan results consolidated and triaged, repository security status determined
  </done>
</task>

</tasks>

<verification>
1. Both scan tools ran successfully on full Git history (521 commits)
2. JSON reports exist and are parseable
3. Zero verified/actionable secrets found (or documented remediation plan if found)
4. Summary document provides clear go/no-go for Phase 27
</verification>

<success_criteria>
- Gitleaks report shows zero verified credential leaks
- TruffleHog report confirms no verified secrets
- All flagged items documented with false positive rationale or remediation plan
- Clear security status: PASS (proceed to Phase 27) or FAIL (remediate first)
</success_criteria>

<output>
After completion, create `.planning/phases/26-security-audit/26-01-SUMMARY.md`
</output>
