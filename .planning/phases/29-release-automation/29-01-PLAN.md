---
phase: 29-release-automation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/publish.yml
autonomous: true

must_haves:
  truths:
    - "Workflow file exists at .github/workflows/publish.yml"
    - "Workflow can be triggered manually via workflow_dispatch"
    - "Workflow builds both NSIS and MSI installers"
    - "Workflow creates draft GitHub Release"
    - "v0.x releases are marked as pre-release automatically"
  artifacts:
    - path: ".github/workflows/publish.yml"
      provides: "Release automation workflow"
      min_lines: 40
      contains: "tauri-apps/tauri-action"
  key_links:
    - from: ".github/workflows/publish.yml"
      to: "tauri.conf.json"
      via: "tauri-action reads bundle config"
      pattern: "tauri-apps/tauri-action"
    - from: ".github/workflows/publish.yml"
      to: "package.json"
      via: "npm install for frontend deps"
      pattern: "npm install"
---

<objective>
Create GitHub Actions workflow for automated release builds using tauri-apps/tauri-action

Purpose: Enable one-click release builds that create GitHub Releases with NSIS and MSI installers
Output: .github/workflows/publish.yml configured for Windows builds with draft releases
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-release-automation/29-RESEARCH.md

# Current configuration files
@src-tauri/tauri.conf.json
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create release workflow file</name>
  <files>.github/workflows/publish.yml</files>
  <action>
Create `.github/workflows/publish.yml` with the following configuration:

**Trigger:**
- `workflow_dispatch` only (manual trigger for testing)
- No tag-based triggers for v0.1 (add later when workflow is validated)

**Permissions:**
- `contents: write` (required for creating releases)

**Job configuration (single job, Windows-only):**
- `runs-on: windows-latest`
- Steps:
  1. `actions/checkout@v4` - checkout repository
  2. `actions/setup-node@v4` - setup Node.js with LTS and npm cache
  3. `dtolnay/rust-toolchain@stable` - install Rust stable
  4. `swatinem/rust-cache@v2` - cache Rust build artifacts (workspaces: './src-tauri -> target')
  5. `npm install` - install frontend dependencies
  6. Pre-release detection step - check if version starts with "0." and output `is_prerelease`
  7. `tauri-apps/tauri-action@v0` - build and release

**tauri-action configuration:**
- `tagName: v__VERSION__` - creates tag from tauri.conf.json version
- `releaseName: 'Depot v__VERSION__'` - release title
- `releaseBody: 'See the assets to download and install this version.'` - simple body
- `releaseDraft: true` - create as draft for review before publishing
- `prerelease: ${{ steps.version-check.outputs.is_prerelease }}` - dynamic based on version

**Pre-release detection script (bash, runs on Windows via Git Bash):**
```bash
VERSION=$(node -p "require('./package.json').version")
if [[ "$VERSION" =~ ^0\. ]]; then
  echo "is_prerelease=true" >> $GITHUB_OUTPUT
else
  echo "is_prerelease=false" >> $GITHUB_OUTPUT
fi
```

**Important:** Use `shell: bash` for the version check step (Windows runners have Git Bash available).

Do NOT include:
- Multi-platform matrix (Windows-only for v0.1)
- Tag-based triggers (manual only for initial testing)
- Code signing (deferred per STATE.md decision)
- Auto-updater JSON upload (not needed for v0.1)
  </action>
  <verify>
1. File exists: `test -f .github/workflows/publish.yml`
2. Contains tauri-action: `grep "tauri-apps/tauri-action" .github/workflows/publish.yml`
3. Has workflow_dispatch: `grep "workflow_dispatch" .github/workflows/publish.yml`
4. Has write permissions: `grep "contents: write" .github/workflows/publish.yml`
5. Has pre-release detection: `grep "is_prerelease" .github/workflows/publish.yml`
6. Has releaseDraft: `grep "releaseDraft: true" .github/workflows/publish.yml`
  </verify>
  <done>
- .github/workflows/publish.yml exists with 50+ lines
- Workflow uses tauri-apps/tauri-action@v0
- Trigger is workflow_dispatch only
- Permissions set to contents: write
- Pre-release detection outputs true for v0.x versions
- Release created as draft
- Single Windows job (no matrix)
  </done>
</task>

<task type="auto">
  <name>Task 2: Document workflow usage in CONTRIBUTING.md</name>
  <files>CONTRIBUTING.md</files>
  <action>
Add a "Release Process" section to CONTRIBUTING.md documenting how to create a release:

**Location:** After the "Pull Request Process" section

**Content to add:**
```markdown
## Release Process

Releases are automated via GitHub Actions. To create a new release:

1. Ensure all changes are committed and pushed to `master`
2. Navigate to **Actions** tab in GitHub
3. Select **Release** workflow from the left sidebar
4. Click **Run workflow** button
5. Select `master` branch and click **Run workflow**
6. Wait for the build to complete (~10-15 minutes)
7. Navigate to **Releases** page
8. Find the draft release and review artifacts
9. Edit release notes if needed
10. Click **Publish release** when ready

The workflow automatically:
- Builds both NSIS (.exe) and MSI installers
- Creates a draft GitHub Release
- Marks v0.x versions as pre-release
- Uploads installers with checksums
```

Keep the existing content intact. Only ADD the new section.
  </action>
  <verify>
1. CONTRIBUTING.md contains "Release Process": `grep "## Release Process" CONTRIBUTING.md`
2. Contains workflow trigger instructions: `grep "Run workflow" CONTRIBUTING.md`
3. Existing content preserved: `grep "Development Setup" CONTRIBUTING.md`
  </verify>
  <done>
- CONTRIBUTING.md updated with Release Process section
- Instructions explain manual workflow trigger
- Existing contributing guidelines preserved
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Workflow file validation:
```bash
# Check file exists and has content
wc -l .github/workflows/publish.yml

# Verify key configuration
grep -E "(tauri-apps/tauri-action|workflow_dispatch|releaseDraft|prerelease)" .github/workflows/publish.yml
```

2. CONTRIBUTING.md validation:
```bash
# Check release section exists
grep -A 5 "## Release Process" CONTRIBUTING.md
```

3. Git status shows new/modified files:
```bash
git status --short
```

Expected output:
- `A  .github/workflows/publish.yml` (new file)
- `M  CONTRIBUTING.md` (modified)
</verification>

<success_criteria>
- [ ] .github/workflows/publish.yml exists with tauri-action configuration
- [ ] Workflow configured for manual trigger only (workflow_dispatch)
- [ ] Pre-release detection marks v0.x versions as pre-release
- [ ] Release created as draft for review
- [ ] CONTRIBUTING.md documents release workflow usage
- [ ] Requirements DIST-01 and DIST-02 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/29-release-automation/29-01-SUMMARY.md`
</output>
