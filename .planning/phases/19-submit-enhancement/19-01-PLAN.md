---
phase: 19-submit-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/actionBadges.ts
  - src/components/ChangelistPanel/SubmitDialog.tsx
  - src/components/DetailPane/ChangelistDetailView.tsx
autonomous: true

must_haves:
  truths:
    - "Submit action shows preview dialog before executing"
    - "Preview dialog shows changelist description"
    - "Preview dialog shows list of files to be submitted"
    - "Files in submit preview show action indicators (add, edit, delete, integrate)"
    - "User can cancel, edit description, or proceed with submit"
  artifacts:
    - path: "src/lib/actionBadges.ts"
      provides: "Shared action badge color utility"
      exports: ["getActionBadgeColor"]
    - path: "src/components/ChangelistPanel/SubmitDialog.tsx"
      provides: "Enhanced submit preview dialog with file list"
      min_lines: 100
  key_links:
    - from: "src/components/ChangelistPanel/SubmitDialog.tsx"
      to: "src/lib/actionBadges.ts"
      via: "import getActionBadgeColor"
      pattern: "import.*getActionBadgeColor.*from.*actionBadges"
    - from: "src/components/DetailPane/ChangelistDetailView.tsx"
      to: "src/lib/actionBadges.ts"
      via: "import getActionBadgeColor"
      pattern: "import.*getActionBadgeColor.*from.*actionBadges"
---

<objective>
Replace SubmitDialog AlertDialog with Dialog-based component showing file list with action badges

Purpose: Current SubmitDialog uses AlertDialog (semantically incorrect for workflow dialogs) and shows plain file names without action indicators. This plan corrects the dialog primitive and adds visual consistency with ChangelistDetailView.

Output: Enhanced SubmitDialog with proper Dialog primitive, scrollable file list with action badges, editable description, and cancel/submit actions.
</objective>

<execution_context>
@C:\Users\a\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\a\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-submit-enhancement/19-RESEARCH.md

# Source files to reference
@src/components/ChangelistPanel/SubmitDialog.tsx (current implementation - 112 lines)
@src/components/DetailPane/ChangelistDetailView.tsx (getActionBadgeColor lines 24-50, file list pattern lines 197-230)
@src/components/dialogs/ReconcilePreviewDialog.tsx (Dialog pattern reference lines 133-266)
@src/components/ui/dialog.tsx (Dialog primitive exports)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract getActionBadgeColor to shared utility</name>
  <files>src/lib/actionBadges.ts, src/components/DetailPane/ChangelistDetailView.tsx</files>
  <action>
Create new file `src/lib/actionBadges.ts` containing:
1. Import `FileAction` from `@/types/p4`
2. Export `getActionBadgeColor(action?: FileAction | string): string` function
   - Copy exact implementation from ChangelistDetailView.tsx lines 24-50
   - Add JSDoc documenting color scheme: edit=blue, add=green, delete=red, branch=purple, integrate=yellow, move=orange
3. Export `formatActionLabel(action?: FileAction | string): string` helper
   - Returns lowercase action string, defaults to 'edit'
   - Converts "move/add" to "move / add" for display

Update `src/components/DetailPane/ChangelistDetailView.tsx`:
1. Remove local `getActionBadgeColor` function (lines 24-50)
2. Add import: `import { getActionBadgeColor } from '@/lib/actionBadges';`
3. Keep all existing Badge usages unchanged (they already use getActionBadgeColor)
  </action>
  <verify>
1. `npx tsc --noEmit` passes with no errors
2. File `src/lib/actionBadges.ts` exists and exports `getActionBadgeColor`
3. `ChangelistDetailView.tsx` no longer has local `getActionBadgeColor` function
4. App builds: `npm run dev` starts without errors
  </verify>
  <done>
Action badge utility extracted to shared location, ChangelistDetailView refactored to use import, TypeScript compiles cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace SubmitDialog with Dialog-based component</name>
  <files>src/components/ChangelistPanel/SubmitDialog.tsx</files>
  <action>
Rewrite `SubmitDialog.tsx` to use Dialog primitive (not AlertDialog):

1. Replace AlertDialog imports with Dialog imports:
   ```typescript
   import {
     Dialog,
     DialogContent,
     DialogHeader,
     DialogTitle,
     DialogFooter,
     DialogDescription,
   } from '@/components/ui/dialog';
   import { Button } from '@/components/ui/button';
   import { Badge } from '@/components/ui/badge';
   import { getActionBadgeColor } from '@/lib/actionBadges';
   import { cn } from '@/lib/utils';
   ```

2. Update component structure following ReconcilePreviewDialog pattern:
   - DialogContent with `className="sm:max-w-2xl max-h-[80vh] flex flex-col"`
   - DialogHeader with title "Submit Changelist {id}"
   - DialogDescription showing file count
   - Content area with `className="flex-1 overflow-auto space-y-4"`
   - DialogFooter with Cancel and Submit buttons

3. Description section (keep existing logic):
   - Label "Description"
   - Textarea with `className="w-full h-24 px-3 py-2 bg-background border border-border rounded-md"`
   - Controlled by local state, synced from changelist.description on open

4. File list section with action badges:
   - Section header: `FILES ({changelist.files.length})`
   - Map over `changelist.files` rendering each file as:
     ```tsx
     <div key={file.depotPath} className="flex items-center gap-2 px-3 py-2 rounded hover:bg-accent">
       <Badge className={cn('px-2 py-0.5 text-xs', getActionBadgeColor(file.action))}>
         {file.action || 'edit'}
       </Badge>
       <span className="flex-1 truncate text-sm">{fileName}</span>
     </div>
     ```
   - Use `max-h-48 overflow-y-auto` on file list container for scrolling

5. Footer with standard buttons:
   - Cancel button: `<Button variant="outline" onClick={() => onOpenChange(false)} disabled={isSubmitting}>Cancel</Button>`
   - Submit button: `<Button onClick={handleSubmit} disabled={isSubmitting || !description.trim()}>{isSubmitting ? 'Submitting...' : 'Submit'}</Button>`

6. Keep existing handleSubmit logic unchanged (calls useFileOperations submit, closes dialog on success)

7. Update useEffect to re-sync description when changelist.description changes:
   ```typescript
   useEffect(() => {
     if (open && changelist) {
       setDescription(changelist.description);
     }
   }, [open, changelist?.description]); // Include description in deps
   ```

8. Add data-testid attributes:
   - DialogContent: `data-testid="submit-dialog"`
   - Description textarea: `data-testid="submit-description"`
   - Submit button: `data-testid="submit-confirm-button"`
  </action>
  <verify>
1. `npx tsc --noEmit` passes with no errors
2. `npm run dev` starts without errors
3. Open submit dialog on a pending changelist with files:
   - Dialog shows changelist description in textarea
   - Dialog shows file list with colored action badges
   - Can edit description, cancel, or submit
4. File actions show correct colors: edit=blue, add=green, delete=red
  </verify>
  <done>
SubmitDialog uses Dialog primitive (not AlertDialog), shows file list with action badges matching ChangelistDetailView styling, description editable, cancel/submit buttons functional.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. App runs: `npm run dev` starts without errors
3. Manual test:
   - Open a pending changelist with files
   - Click Submit button to open dialog
   - Verify dialog shows description textarea
   - Verify dialog shows file list with action badges
   - Verify badges use correct colors (edit=blue, add=green, etc.)
   - Verify can cancel dialog
   - Verify can submit with edited description
4. Existing E2E tests pass: `npm run test:e2e` (if submit tests exist)
</verification>

<success_criteria>
- [ ] `getActionBadgeColor` extracted to `src/lib/actionBadges.ts`
- [ ] ChangelistDetailView imports from shared utility
- [ ] SubmitDialog uses Dialog primitive (not AlertDialog)
- [ ] Submit preview shows file list with action badges
- [ ] Action badge colors match ChangelistDetailView (edit=blue, add=green, delete=red)
- [ ] Description textarea editable
- [ ] Cancel and Submit buttons functional
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/19-submit-enhancement/19-01-SUMMARY.md`
</output>
