---
phase: 02-core-workflows
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/FileTree/FileNode.tsx
  - src/components/FileTree/FileStatusIcon.tsx
  - src/components/ChangelistPanel/ChangelistNode.tsx
autonomous: true

must_haves:
  truths:
    - "react-arborist is installed and available"
    - "Tree node components render file/folder with status icons"
    - "Status icons are color-coded per P4V conventions"
  artifacts:
    - path: "package.json"
      provides: "react-arborist dependency"
      contains: "react-arborist"
    - path: "src/components/FileTree/FileNode.tsx"
      provides: "File tree node renderer"
      exports: ["FileNode"]
    - path: "src/components/FileTree/FileStatusIcon.tsx"
      provides: "File status badge component"
      exports: ["FileStatusIcon"]
    - path: "src/components/ChangelistPanel/ChangelistNode.tsx"
      provides: "Changelist tree node renderer"
      exports: ["ChangelistNode"]
  key_links:
    - from: "src/components/FileTree/FileNode.tsx"
      to: "src/components/FileTree/FileStatusIcon.tsx"
      via: "component import"
      pattern: "import.*FileStatusIcon"
    - from: "src/components/FileTree/FileStatusIcon.tsx"
      to: "lucide-react"
      via: "icon imports"
      pattern: "import.*from.*lucide-react"
---

<objective>
Install react-arborist and create reusable tree node components for file tree and changelist views.

Purpose: These node components are the building blocks for both the workspace file tree and the changelist panel. Creating them first allows parallel development of the tree containers.

Output: Installed dependency, FileNode component with status icons, ChangelistNode component.
</objective>

<execution_context>
@./.claude/agents/gsd-planner.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-workflows/02-CONTEXT.md
@.planning/phases/02-core-workflows/02-RESEARCH.md
@src/components/ui/collapsible.tsx
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-arborist</name>
  <files>package.json</files>
  <action>
Install react-arborist for tree view functionality:

```bash
npm install react-arborist
```

Verify installation by checking package.json includes "react-arborist" in dependencies.

Note: react-arborist provides:
- Virtualized tree rendering (handles 10,000+ nodes)
- Built-in drag-and-drop
- Keyboard navigation and ARIA
- Selection management
  </action>
  <verify>`npm ls react-arborist` shows installed version</verify>
  <done>react-arborist appears in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create FileStatusIcon component</name>
  <files>src/components/FileTree/FileStatusIcon.tsx</files>
  <action>
Create status icon component following P4V conventions:

**Props:**
- status: FileStatus (from @/types/p4)
- className?: string

**Status to icon/color mapping (use lucide-react icons):**
- synced: CheckCircle2, green-500 (at head, no changes)
- checkedOut: Edit3, blue-500 (opened for edit by user)
- added: Plus, green-400 (opened for add)
- deleted: Trash2, red-500 (opened for delete)
- modified: Circle (filled), yellow-500 (local changes)
- outOfDate: ArrowDown, orange-500 (newer in depot)
- conflict: AlertTriangle, red-600 (conflict state)

**Implementation:**
- Use cn() utility for className merging
- Icon size: w-4 h-4 (16px)
- Export both component and a getStatusColor helper function

```typescript
interface FileStatusIconProps {
  status: FileStatus;
  className?: string;
}

export function FileStatusIcon({ status, className }: FileStatusIconProps) {
  // Map status to icon and color
}

export function getStatusColor(status: FileStatus): string {
  // Return Tailwind color class
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit src/components/FileTree/FileStatusIcon.tsx`</verify>
  <done>FileStatusIcon renders appropriate icon and color for each FileStatus</done>
</task>

<task type="auto">
  <name>Task 3: Create FileNode and ChangelistNode components</name>
  <files>src/components/FileTree/FileNode.tsx, src/components/ChangelistPanel/ChangelistNode.tsx</files>
  <action>
**FileNode.tsx:**

Create node renderer for react-arborist tree (file/folder display):

```typescript
import { NodeRendererProps } from 'react-arborist';
import { P4File } from '@/types/p4';

interface FileNodeData {
  id: string;
  name: string;
  isFolder: boolean;
  file?: P4File;
  children?: FileNodeData[];
}

export function FileNode({ node, style, dragHandle }: NodeRendererProps<FileNodeData>) {
  // Render row
}
```

**Display elements:**
- Folder icon (FolderOpen when expanded, Folder when collapsed) OR file icon (File)
- Status icon (FileStatusIcon) if file has status
- File/folder name
- Revision number (#rev) for files, right-aligned, text-slate-500
- Hover state: bg-slate-800
- Selected state: bg-blue-900/50

Use Tailwind classes, cn() for conditional styling.
Handle both folders (isFolder=true, has children) and files (isFolder=false, has file data).

**ChangelistNode.tsx:**

Create node renderer for changelist tree:

```typescript
import { NodeRendererProps } from 'react-arborist';
import { P4Changelist, P4File } from '@/types/p4';

type ChangelistNodeData =
  | { type: 'changelist'; data: P4Changelist }
  | { type: 'file'; data: P4File };

export function ChangelistNode({ node, style, dragHandle }: NodeRendererProps<ChangelistNodeData>) {
  // Render changelist header or file row
}
```

**Changelist row (type='changelist'):**
- List icon (List)
- Changelist description (truncate if long)
- File count badge (pill style, bg-slate-700)
- "default" label for changelist 0

**File row (type='file'):**
- Status icon
- File name only (not full path)
- Same hover/selected styling as FileNode
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit src/components/FileTree/FileNode.tsx src/components/ChangelistPanel/ChangelistNode.tsx`</verify>
  <done>Both node components render with proper styling and handle their data types</done>
</task>

</tasks>

<verification>
- react-arborist installed and in package.json
- FileStatusIcon renders distinct icon/color for each status
- FileNode handles both folders and files
- ChangelistNode handles both changelist headers and file entries
- All imports resolve correctly
</verification>

<success_criteria>
- Tree node components are reusable and properly typed
- Status icons follow P4V color conventions
- Components are styled consistently with existing dark theme
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-workflows/02-02-SUMMARY.md`
</output>
