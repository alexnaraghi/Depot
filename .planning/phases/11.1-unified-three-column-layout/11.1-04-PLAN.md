---
phase: 11.1-unified-three-column-layout
plan: 04
type: execute
wave: 3
depends_on: ["11.1-02", "11.1-03"]
files_modified:
  - src/components/DetailPane/DetailBreadcrumb.tsx
  - src/components/DetailPane/DetailPane.tsx
  - src/components/FileTree/FileTree.tsx
  - src/components/FileTree/FileNode.tsx
  - src/components/ChangelistPanel/ChangelistPanel.tsx
  - src/components/ChangelistPanel/ChangelistNode.tsx
autonomous: true

must_haves:
  truths:
    - "Breadcrumb shows navigation path at top of detail pane (e.g., CL 4521 > engine.cpp > #42)"
    - "Back arrow and Escape pop one level in the navigation stack"
    - "Clicking a file in the file tree updates the detail pane to show that file"
    - "Clicking a CL header in the changelist panel updates the detail pane to show that CL"
    - "Breadcrumb segments are clickable for direct jumps"
  artifacts:
    - path: "src/components/DetailPane/DetailBreadcrumb.tsx"
      provides: "Breadcrumb navigation bar with back button and clickable segments"
  key_links:
    - from: "src/components/FileTree/FileTree.tsx"
      to: "src/stores/detailPaneStore.ts"
      via: "selectFile on file click/select"
    - from: "src/components/ChangelistPanel/ChangelistNode.tsx"
      to: "src/stores/detailPaneStore.ts"
      via: "selectChangelist on CL header click"
    - from: "src/components/DetailPane/DetailBreadcrumb.tsx"
      to: "src/stores/detailPaneStore.ts"
      via: "goBack and navigate for breadcrumb clicks"
---

<objective>
Wire up selection events from the file tree and changelist panel to the detail pane store, and add breadcrumb navigation.

Purpose: This connects the side columns to the center detail pane, making the three-column layout interactive. The breadcrumb enables back navigation through the drill-down stack.
Output: Clicking files and CLs in the side columns drives the detail pane. Breadcrumb shows navigation path with back support.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/design/unified-column-layout.md
@.planning/phases/11.1-unified-three-column-layout/11.1-01-SUMMARY.md
@.planning/phases/11.1-unified-three-column-layout/11.1-02-SUMMARY.md
@.planning/phases/11.1-unified-three-column-layout/11.1-03-SUMMARY.md
@src/stores/detailPaneStore.ts
@src/components/DetailPane/DetailPane.tsx
@src/components/FileTree/FileTree.tsx
@src/components/FileTree/FileNode.tsx
@src/components/ChangelistPanel/ChangelistPanel.tsx
@src/components/ChangelistPanel/ChangelistNode.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DetailBreadcrumb and wire into DetailPane</name>
  <files>src/components/DetailPane/DetailBreadcrumb.tsx, src/components/DetailPane/DetailPane.tsx</files>
  <action>
**DetailBreadcrumb.tsx:**
Create a breadcrumb navigation bar that sits at the top of the detail pane.

**Rendering logic based on selection + history:**
- Read `selection` and `history` from useDetailPaneStore
- If `selection.type === 'none'`: Don't render breadcrumb at all (workspace summary has no nav)
- Build breadcrumb segments from history + current selection:
  - Each history item becomes a clickable segment
  - Current selection is the last segment (not clickable, bold)

**Segment labels:**
- `type: 'none'` -> "Workspace"
- `type: 'file'` -> filename extracted from depotPath
- `type: 'changelist'` -> `CL ${changelist.id}`
- `type: 'revision'` -> `#${revision.rev}`

**Layout:**
```
[← back] Workspace > CL 4521 > engine.cpp > #42
```

- Back arrow button (ArrowLeft icon from lucide): calls `useDetailPaneStore.getState().goBack()`. Disabled when history is empty.
- Segments separated by `>` (ChevronRight icon, small, muted)
- Clickable segments: on click, navigate to that history entry by calling `navigate()` with that selection and trimming history to that point. Implementation: store the index, and when clicked, set selection to that item and truncate history to items before it.
- Current (last) segment: bold, not clickable

**Keyboard shortcut:**
- Listen for Escape key in DetailPane: call `goBack()` if history exists, else call `clear()`.
- Add this in DetailPane.tsx using useEffect with keydown listener, NOT in the breadcrumb.

**Wire into DetailPane.tsx:**
- Add `<DetailBreadcrumb />` at the top of the detail pane, above the view content
- Add a divider line below breadcrumb when it's visible
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>Breadcrumb shows navigation path with clickable segments and back button. Escape key navigates back.</done>
</task>

<task type="auto">
  <name>Task 2: Wire file tree and changelist panel selections to detail pane store</name>
  <files>src/components/FileTree/FileTree.tsx, src/components/FileTree/FileNode.tsx, src/components/ChangelistPanel/ChangelistPanel.tsx, src/components/ChangelistPanel/ChangelistNode.tsx</files>
  <action>
**FileTree - wire file selection:**
In FileTree.tsx or FileNode.tsx, when a file node is clicked (single click / onSelect):
- Import `useDetailPaneStore` from `@/stores/detailPaneStore`
- On file selection (when a file node is activated/clicked), call `useDetailPaneStore.getState().selectFile(file.depotPath, file.localPath)`
- This should work alongside the existing `setSelectedFile` in fileTreeStore (keep both — fileTreeStore tracks which file is selected in the TREE for context menu purposes, detailPaneStore drives the DETAIL PANE)
- Find where file click/select currently happens. In FileNode.tsx, look for onClick or onActivate handlers. Add the store call there.
- Make sure right-click (context menu) does NOT change the detail pane selection — only left-click should.

**ChangelistPanel - wire CL header click:**
In ChangelistNode.tsx, the changelist header row needs a click handler:
- When a changelist header node is clicked (left-click, not right-click), call `useDetailPaneStore.getState().selectChangelist(changelist)`
- Look at the existing ChangelistNode.tsx to find where CL headers are rendered. Add onClick to the CL header element.
- File nodes within the CL panel: when a file in the CL tree is clicked, call `useDetailPaneStore.getState().selectFile(file.depotPath, file.localPath, changelist.id)` — include the CL id as `fromCl` context.
- Right-click (context menu) should NOT change the detail pane.

**Important:** Keep all existing behavior intact. The file tree and CL panel should continue to work as before (expand/collapse, drag-drop, context menus). The detail pane selection is ADDITIVE — it doesn't replace existing click handlers, it adds to them.
  </action>
  <verify>`npx tsc --noEmit` passes. Run `npm run dev`, click a file in the tree — center pane should show file detail. Click a CL header — center pane should show CL detail.</verify>
  <done>Clicking files in tree shows file detail in center pane. Clicking CL headers shows CL detail. Breadcrumb updates to reflect navigation path. Back button and Escape navigate backward. All existing FileTree and ChangelistPanel behavior preserved.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Click file in tree -> detail pane shows FileDetailView
3. Click CL header -> detail pane shows ChangelistDetailView
4. Click file in CL detail -> drills into FileDetailView with breadcrumb "CL 123 > file.cpp"
5. Click history row in file detail -> drills into RevisionDetailView
6. Back button pops navigation stack
7. Escape key navigates back or clears selection
8. Breadcrumb segments are clickable
9. Drag-drop, context menus, and all existing behavior still work
</verification>

<success_criteria>
Side columns drive the detail pane via selection. Breadcrumb navigation works with clickable segments and back button. All existing functionality preserved.
</success_criteria>

<output>
After completion, create `.planning/phases/11.1-unified-three-column-layout/11.1-04-SUMMARY.md`
</output>
