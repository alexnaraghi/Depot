---
phase: 11.1-unified-three-column-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/stores/detailPaneStore.ts
  - src/components/DetailPane/DetailPane.tsx
  - src/components/MainLayout.tsx
autonomous: true

must_haves:
  truths:
    - "Main window shows three columns: file tree (left), detail pane (center), changelists (right)"
    - "Clicking a file in the tree or CL panel changes what the detail pane displays"
    - "Detail pane renders placeholder content based on selection type"
  artifacts:
    - path: "src/stores/detailPaneStore.ts"
      provides: "Selection state management with navigation stack"
      exports: ["useDetailPaneStore"]
    - path: "src/components/DetailPane/DetailPane.tsx"
      provides: "Center column that switches views based on selection"
    - path: "src/components/MainLayout.tsx"
      provides: "Three-column layout with file tree, detail pane, changelists"
  key_links:
    - from: "src/components/MainLayout.tsx"
      to: "src/components/DetailPane/DetailPane.tsx"
      via: "JSX composition in center column"
    - from: "src/stores/detailPaneStore.ts"
      to: "src/components/DetailPane/DetailPane.tsx"
      via: "useDetailPaneStore hook reads selection"
---

<objective>
Create the selection state store and restructure MainLayout from two-column to three-column layout with a DetailPane shell in the center.

Purpose: This is the foundational change that all other plans build on. The three-column layout and selection store must exist before detail views can be implemented.
Output: Working three-column layout with placeholder detail pane that responds to selection changes.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/design/unified-column-layout.md
@src/components/MainLayout.tsx
@src/stores/fileTreeStore.ts
@src/types/p4.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create detail pane selection store</name>
  <files>src/stores/detailPaneStore.ts</files>
  <action>
Create a Zustand store that manages what's displayed in the detail pane. Use the same pattern as fileTreeStore.ts (create from zustand).

**Selection types (discriminated union):**
```typescript
type DetailSelection =
  | { type: 'none' }                                           // Workspace summary
  | { type: 'file'; depotPath: string; localPath: string; fromCl?: number }  // File detail
  | { type: 'changelist'; changelist: P4Changelist }           // CL detail
  | { type: 'revision'; depotPath: string; localPath: string; revision: P4Revision }  // Revision detail
```

**Store state:**
- `selection: DetailSelection` - current selection (default: `{ type: 'none' }`)
- `history: DetailSelection[]` - back stack (max 3 items, NOT including current)

**Store actions:**
- `navigate(selection: DetailSelection)` - Push current to history (if not 'none'), set new selection. If history > 3, shift oldest.
- `goBack()` - Pop from history into current selection. If history empty, set to `{ type: 'none' }`.
- `selectFile(depotPath: string, localPath: string, fromCl?: number)` - Convenience: calls navigate with file selection. Resets history to depth 1 (direct selection from side column).
- `selectChangelist(changelist: P4Changelist)` - Convenience: calls navigate with CL selection. Resets history to depth 1.
- `drillToFile(depotPath: string, localPath: string, fromCl?: number)` - Like navigate but preserves full history (used when clicking file inside CL detail view).
- `drillToRevision(depotPath: string, localPath: string, revision: P4Revision)` - Navigate to revision detail, preserving history.
- `clear()` - Reset to `{ type: 'none' }`, clear history.

Import P4Changelist from `@/types/p4` and P4Revision from `@/lib/tauri`.

Key design point: `selectFile`/`selectChangelist` RESET history (clicking in side columns = new navigation root). `drillToFile`/`drillToRevision` PRESERVE history (clicking within detail pane = deeper navigation).
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>Store exports useDetailPaneStore with all selection types and navigation actions.</done>
</task>

<task type="auto">
  <name>Task 2: Create DetailPane shell and restructure MainLayout to three columns</name>
  <files>src/components/DetailPane/DetailPane.tsx, src/components/MainLayout.tsx</files>
  <action>
**DetailPane.tsx:**
Create a new component that reads from useDetailPaneStore and renders placeholder content based on selection type:
- `type: 'none'` -> Show "Workspace Summary" placeholder text
- `type: 'file'` -> Show "File: {depotPath}" placeholder text
- `type: 'changelist'` -> Show "Changelist: #{id}" placeholder text
- `type: 'revision'` -> Show "Revision: #{rev}" placeholder text

Wrap in a div with `className="flex flex-col h-full bg-background"`. Add a header area for future breadcrumb.

**MainLayout.tsx restructure:**
Transform the current two-column layout (file tree + sidebar) into three columns:

Current structure:
```
<div className="flex-1 flex overflow-hidden">
  <main> FileTree </main>
  <resize-handle />
  <aside> ChangelistPanel </aside>
</div>
```

New structure:
```
<div className="flex-1 flex overflow-hidden">
  {/* Left column: File tree */}
  <div style={{ width: leftWidth, minWidth: 200 }}>
    <FileTree />
  </div>

  {/* Left resize handle */}
  <div onMouseDown={handleLeftResize} className="w-1 bg-border hover:bg-primary cursor-col-resize" />

  {/* Center column: Detail pane */}
  <div className="flex-1 overflow-hidden">
    <DetailPane />
  </div>

  {/* Right resize handle */}
  <div onMouseDown={handleRightResize} className="w-1 bg-border hover:bg-primary cursor-col-resize" />

  {/* Right column: Changelists */}
  <div style={{ width: rightWidth, minWidth: 200 }}>
    <ChangelistPanel className="h-full" />
  </div>
</div>
```

**Resize state changes:**
- Replace single `sidebarWidth`/`sidebarCollapsed` state with `leftWidth` (default 280) and `rightWidth` (default 320).
- Remove sidebar collapse/expand logic entirely (three-column layout doesn't collapse).
- Keep the same resize pattern (mousedown/mousemove/mouseup) but support TWO independent resize handles:
  - Left handle: `leftWidth = e.clientX` (constrained 150-500px)
  - Right handle: `rightWidth = window.innerWidth - e.clientX` (constrained 200-500px)
- Use a state variable `resizingColumn: 'left' | 'right' | null` to track which handle is being dragged.

Remove imports: ChevronLeft, ChevronRight (no longer needed for collapse).
Add import: DetailPane from `@/components/DetailPane/DetailPane`.

Do NOT wire up click events from FileTree/ChangelistPanel to the store yet - that comes in later plans. The store exists, the layout exists, but selection is only changeable programmatically for now.
  </action>
  <verify>Run `npm run dev` and verify the app shows three columns. The center column should show "Workspace Summary" placeholder. Both resize handles should work independently.</verify>
  <done>MainLayout renders three-column layout with independent resize handles. DetailPane shows placeholder based on selection store state.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. App runs with `npm run dev` and shows three-column layout
3. Center column shows "Workspace Summary" text
4. Left resize handle adjusts file tree width
5. Right resize handle adjusts changelist panel width
6. File tree and changelist panel continue to function as before
</verification>

<success_criteria>
Three-column layout visible with file tree (left), detail pane placeholder (center), changelists (right). Both resize handles work. Selection store created with all types and navigation methods.
</success_criteria>

<output>
After completion, create `.planning/phases/11.1-unified-three-column-layout/11.1-01-SUMMARY.md`
</output>
