---
phase: 11.1-unified-three-column-layout
plan: 03
subsystem: ui-detail-views
tags: [react, detail-pane, changelists, revisions, ui-components]
dependencies:
  requires: [11.1-01, 11.1-02]
  provides: [changelist-detail-view, revision-detail-view, complete-detail-pane-routing]
  affects: [11.1-04, 11.1-05]
tech-stack:
  added: []
  patterns: [discriminated-union-routing, drill-down-navigation]
key-files:
  created:
    - src/components/DetailPane/ChangelistDetailView.tsx
    - src/components/DetailPane/RevisionDetailView.tsx
  modified:
    - src/components/DetailPane/DetailPane.tsx
decisions:
  - slug: reuse-existing-dialogs
    summary: "Reuse SubmitDialog and EditDescriptionDialog from ChangelistPanel directory"
    rationale: "These dialogs are already built and tested - no need to recreate them for the detail pane"
  - slug: shelved-files-query
    summary: "Use existing useShelvedFilesQuery hook for shelved files display"
    rationale: "Consistent with ShelvedFilesSection pattern, reuses existing query infrastructure"
  - slug: revision-sibling-files-placeholder
    summary: "Placeholder for sibling files in revision detail (needs p4_describe backend)"
    rationale: "Backend lacks p4_describe command for submitted CLs - acceptable for initial implementation, future phase can add it"
metrics:
  duration: 5 min
  completed: 2026-01-31
---

# Phase 11.1 Plan 03: Changelist and Revision Detail Views Summary

**One-liner:** ChangelistDetailView and RevisionDetailView complete the detail pane with CL actions, file lists, and revision diff operations.

## What Was Built

### ChangelistDetailView Component

Created comprehensive changelist detail view with:

- **Header section:** CL number with status badge (Pending/Submitted), description with italic fallback for empty
- **Action buttons:**
  - Submit → Opens SubmitDialog (reused from ChangelistPanel)
  - Shelve → Uses useShelve hook, disabled for default CL or empty CLs
  - Delete → Uses invokeP4DeleteChange, only for empty numbered CLs
  - Edit Description → Opens EditDescriptionDialog (reused from ChangelistPanel)
- **File list:** Action badges with color coding (edit=blue, add=green, delete=red), clickable rows that drill to FileDetailView with CL context
- **Shelved files section:** Queries shelvedFiles, shows violet-accented list only when shelved files exist

### RevisionDetailView Component

Created revision detail view with:

- **Header:** Filename > revision number, user, formatted date, description
- **Diff actions:**
  - Diff vs Previous → Uses useDiff().diffRevisions, disabled for add/branch actions or rev=1
  - Diff vs Workspace → Uses useDiff().diffAgainstWorkspace
  - Open This Revision → Placeholder (needs invokeP4Print backend)
- **Sibling files section:** Placeholder text noting backend needs p4_describe command for submitted CLs

### DetailPane Routing

Updated DetailPane.tsx to wire all four detail views:

- Added imports for ChangelistDetailView and RevisionDetailView
- Replaced placeholders with actual components
- All selection types now route to proper views:
  - `type: 'none'` → WorkspaceSummaryView
  - `type: 'file'` → FileDetailView
  - `type: 'changelist'` → ChangelistDetailView
  - `type: 'revision'` → RevisionDetailView

## Tasks Completed

| Task | Name                                                        | Commit  | Files                                                                    |
| ---- | ----------------------------------------------------------- | ------- | ------------------------------------------------------------------------ |
| 1    | Create ChangelistDetailView                                 | 54423d9 | src/components/DetailPane/ChangelistDetailView.tsx                       |
| 2    | Create RevisionDetailView and wire all views into DetailPane | c887731 | src/components/DetailPane/RevisionDetailView.tsx, DetailPane.tsx         |

## Deviations from Plan

None - plan executed exactly as written.

## Decisions Made

**Reuse existing dialogs from ChangelistPanel:** Rather than recreating SubmitDialog and EditDescriptionDialog, imported them directly from `@/components/ChangelistPanel/`. This maintains consistency with the existing changelist panel behavior and avoids duplicating dialog logic.

**Shelved files query pattern:** Used the existing `useShelvedFilesQuery(changelist.id)` hook, consistent with how ShelvedFilesSection works in the changelist tree. This ensures consistent data fetching across both the side panel and detail pane.

**Revision sibling files placeholder:** The backend does NOT have a general `p4_describe` command (only `p4_describe_shelved` for shelved files). Instead of creating a non-functional UI, added a clear placeholder message and TODO comment. A future phase can add the backend command and populate this section.

## Technical Notes

### Color Coding Patterns

File action badges follow established color scheme:
- Edit: `bg-blue-900/30 text-blue-300`
- Add: `bg-green-900/30 text-green-300`
- Delete: `bg-red-900/30 text-red-300`
- Branch: `bg-purple-900/30 text-purple-300`
- Integrate: `bg-yellow-900/30 text-yellow-300`
- Move: `bg-orange-900/30 text-orange-300`

Shelved files use violet accent throughout for visual distinction.

### Drill-Down Navigation

File clicks in both CL and revision detail views use `drillToFile()` from the detail pane store, which preserves navigation history. This enables the back button and breadcrumb navigation (to be implemented in plan 05).

### Action Button States

All action buttons implement proper disabled states:
- Submit: disabled if no files or not pending
- Shelve: disabled if no files, default CL, or mutation in progress
- Delete: disabled if not empty or default CL
- Diff vs Previous: disabled for add/branch actions or first revision

## Next Phase Readiness

**Plan 11.1-04 (File tree clicks):** Ready - ChangelistDetailView is wired and waiting for FileTree click handlers.

**Plan 11.1-05 (Breadcrumb navigation):** Ready - All detail views support drill-down, history stack exists in store, just needs breadcrumb UI component.

**Future backend enhancement:** RevisionDetailView sibling files section needs `p4_describe` backend command. Low priority - can be added in any future phase when backend work is scheduled.

## Outcome

All four detail views (workspace summary, file detail, CL detail, revision detail) now render in the detail pane based on selection type. Navigation between views works through the selection store. The detail pane is functionally complete and ready for click handler wiring in plans 04-05.
