---
phase: 19-submit-enhancement
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - src/components/ChangelistPanel/SubmitDialog.tsx
autonomous: false

must_haves:
  truths:
    - "User can click file in preview to view content before submitting"
    - "Dialog remains open while user reviews files in detail pane"
    - "User can review multiple files then return to submit"
  artifacts:
    - path: "src/components/ChangelistPanel/SubmitDialog.tsx"
      provides: "File click navigation to detail pane"
      contains: "drillToFile"
  key_links:
    - from: "src/components/ChangelistPanel/SubmitDialog.tsx"
      to: "src/stores/detailPaneStore"
      via: "drillToFile call"
      pattern: "drillToFile\\(file\\.depotPath"
---

<objective>
Add file click navigation from submit preview to detail pane

Purpose: Users need to review file content before submitting. Clicking a file in the submit preview navigates to FileContentViewer in the detail pane while keeping the dialog open, allowing review of multiple files before proceeding with submit.

Output: Clickable file names in submit dialog that navigate to file detail view, dialog stays open during file review.
</objective>

<execution_context>
@C:\Users\a\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\a\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-submit-enhancement/19-RESEARCH.md
@.planning/phases/19-submit-enhancement/19-01-SUMMARY.md

# Source files to reference
@src/components/ChangelistPanel/SubmitDialog.tsx (Plan 01 output)
@src/components/DetailPane/ChangelistDetailView.tsx (drillToFile pattern lines 65, 208)
@src/stores/detailPaneStore.ts (drillToFile function)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add file click navigation to submit dialog</name>
  <files>src/components/ChangelistPanel/SubmitDialog.tsx</files>
  <action>
Update SubmitDialog to make file names clickable, navigating to detail pane:

1. Import detailPaneStore:
   ```typescript
   import { useDetailPaneStore } from '@/stores/detailPaneStore';
   ```

2. Get drillToFile from store inside component:
   ```typescript
   const drillToFile = useDetailPaneStore(s => s.drillToFile);
   ```

3. Add file click handler function:
   ```typescript
   const handleFileClick = (depotPath: string, localPath: string, changelistId: number) => {
     // Navigate to file in detail pane, keep dialog open
     drillToFile(depotPath, localPath, changelistId);
     // Dialog stays open - user can review files and return to submit
   };
   ```

4. Update file list rendering to make file names clickable:
   ```tsx
   {changelist.files.map((file) => {
     const fileName = file.depotPath.split('/').pop() || file.depotPath;
     return (
       <div
         key={file.depotPath}
         className="flex items-center gap-2 px-3 py-2 rounded hover:bg-accent"
       >
         <Badge className={cn('px-2 py-0.5 text-xs', getActionBadgeColor(file.action))}>
           {file.action || 'edit'}
         </Badge>
         <button
           type="button"
           className="flex-1 text-left truncate text-sm hover:underline focus:outline-none focus:ring-1 focus:ring-ring rounded"
           onClick={() => handleFileClick(file.depotPath, file.localPath, changelist.id)}
           data-testid={`submit-file-${fileName}`}
         >
           {fileName}
         </button>
       </div>
     );
   })}
   ```

5. Key behaviors to preserve:
   - Dialog DOES NOT close when file is clicked
   - User can click multiple files to review
   - User closes dialog manually via Cancel or submits via Submit
   - Detail pane shows FileDetailView with file content
  </action>
  <verify>
1. `npx tsc --noEmit` passes with no errors
2. `npm run dev` starts without errors
3. Manual test:
   - Open submit dialog on changelist with files
   - Click a file name
   - Detail pane navigates to show that file
   - Submit dialog remains open
   - Can click another file - detail pane updates
   - Can still Cancel or Submit from dialog
  </verify>
  <done>
File names in submit dialog are clickable, clicking navigates detail pane to file content, dialog remains open for continued review.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete submit preview enhancement with file list, action badges, and click-to-view navigation
  </what-built>
  <how-to-verify>
1. Start the app: `npm run dev`
2. Ensure you have a pending changelist with at least 2-3 files with different actions (edit, add if possible)
3. In the changelist panel, click on the pending changelist
4. In the detail pane, click the "Submit" button to open the submit dialog
5. Verify the dialog shows:
   - Changelist number in title
   - File count in description
   - Editable description textarea
   - File list with action badges (colored: edit=blue, add=green, delete=red)
   - Cancel and Submit buttons
6. Click on a file name in the list
7. Verify:
   - Detail pane navigates to show that file's content
   - Submit dialog REMAINS OPEN (floating on left side)
8. Click another file in the submit dialog
9. Verify detail pane updates to show new file
10. Edit the description in textarea
11. Click Submit button
12. Verify changelist submits successfully
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. App runs: `npm run dev` starts without errors
3. Manual test per checkpoint above
4. Requirements coverage check:
   - SUBMIT-01: Submit action shows preview dialog before executing ✓
   - SUBMIT-02: Preview dialog shows changelist description ✓
   - SUBMIT-03: Preview dialog shows list of files to be submitted ✓
   - SUBMIT-04: User can cancel, edit description, or proceed with submit ✓
   - Success criteria #5: User can click file in preview to view content ✓
</verification>

<success_criteria>
- [ ] File names in submit dialog are clickable buttons
- [ ] Clicking file navigates detail pane to file content
- [ ] Submit dialog remains open during file review
- [ ] Can review multiple files then return to submit
- [ ] Cancel and Submit buttons still functional
- [ ] All SUBMIT-01 through SUBMIT-04 requirements met
- [ ] Success criteria #5 (click file to view content) met
</success_criteria>

<output>
After completion, create `.planning/phases/19-submit-enhancement/19-02-SUMMARY.md`
</output>
