---
phase: 01-non-blocking-foundation
plan: 05
type: execute
wave: 4
depends_on: ["01-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Developer can spawn p4 command and UI remains responsive"
    - "Developer can click Cancel and process terminates immediately"
    - "Developer can close app during operation and no zombies remain"
    - "No main thread blocking >16ms during p4 operations"
  artifacts: []
  key_links: []
---

<objective>
Verify Phase 1 success criteria through manual testing

Purpose: Confirm the non-blocking foundation meets all requirements before moving to Phase 2
Output: Verified working async architecture ready for core workflows implementation
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-non-blocking-foundation/01-CONTEXT.md
@.planning/phases/01-non-blocking-foundation/01-04-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete non-blocking foundation including:
    - Rust process manager with async Mutex for tracking Child handles
    - Tauri commands for spawn, kill, and batch kill
    - Zustand store for operation status and output lines
    - React hooks with TanStack Query integration
    - StatusBar with progress and cancel button
    - Collapsible OutputPanel with deferred rendering
    - Toast notifications for non-blocking errors
    - App close handler for process cleanup
  </what-built>
  <how-to-verify>
    **Prerequisites:**
    - p4.exe must be installed and in PATH
    - OR: Modify test to use any long-running command

    **Test 1: UI Responsiveness During Operation**
    1. Run `npm run tauri dev`
    2. Open DevTools (Ctrl+Shift+I) -> Performance tab
    3. Click "Test p4 info" button
    4. During operation, verify:
       - Status bar shows "Running: p4 info" with spinner
       - UI remains interactive (can expand Output panel)
       - No red long-task markers in Performance timeline

    **Test 2: Cancel Button Functionality**
    1. Click "Test p4 sync -n" (or create a longer operation)
    2. While operation runs, verify Cancel button appears
    3. Click Cancel button
    4. Verify:
       - Status bar shows "Cancelling..."
       - Operation stops quickly
       - Toast or status shows "Cancelled by user"

    **Test 3: Zombie Process Prevention**
    1. Start a long p4 operation (p4 sync -n on large depot)
    2. While operation runs, close the app window (X button)
    3. Open Windows Task Manager (Ctrl+Shift+Esc)
    4. Verify: No orphaned p4.exe processes remain

    **Test 4: Performance Budget (<16ms)**
    1. Open DevTools Performance tab
    2. Start recording
    3. Run "Test p4 sync -n" with streaming output
    4. Stop recording after operation completes
    5. Verify: No "Long Task" warnings (>50ms) in timeline
    6. Check: Main thread blocks should be <16ms

    **Test 5: Error Handling (Non-Modal)**
    1. Test with invalid p4 command or no p4 connection
    2. Verify:
       - Error appears as toast notification (not modal dialog)
       - Toast auto-dismisses after 8 seconds
       - UI remains interactive during error display
       - Error logged in Output panel

    **Test 6: Output Panel Functionality**
    1. Run p4 command that produces output
    2. Expand Output panel
    3. Verify:
       - Output lines appear in real-time
       - Panel auto-scrolls to bottom
       - stderr lines appear in red
       - Clear button removes all output
       - Panel can collapse/expand during operation
  </how-to-verify>
  <resume-signal>
    Type "verified" if all tests pass.
    If any test fails, describe the failure and we'll create a fix plan.
  </resume-signal>
</task>

</tasks>

<verification>
Phase 1 Success Criteria from ROADMAP.md:

1. [x] Developer can spawn p4 command (p4 info) and UI remains responsive during execution
2. [x] Developer can click Cancel button during long p4 operation and process terminates immediately
3. [x] Developer can close app during active p4 operation and no orphaned p4.exe processes remain in Task Manager
4. [x] DevTools performance monitor shows no main thread blocking >16ms during p4 operations
</verification>

<success_criteria>
All manual verification tests pass. Non-blocking foundation is ready for Phase 2: Core Workflows.
</success_criteria>

<output>
After verification passes, create `.planning/phases/01-non-blocking-foundation/01-05-SUMMARY.md` documenting:
- Test results for each verification
- Any edge cases discovered
- Performance measurements
- Ready state for Phase 2
</output>
