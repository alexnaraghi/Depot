---
phase: 16-file-content-viewer
plan: 02
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - src/components/DetailPane/FileContentViewer.tsx
  - src/components/DetailPane/SyntaxHighlightedContent.tsx
  - src/hooks/useFileContent.ts
  - src/components/DetailPane/RevisionDetailView.tsx
autonomous: true

must_haves:
  truths:
    - "User can view file content at any revision in detail pane"
    - "File content shows syntax highlighting appropriate for file extension"
  artifacts:
    - path: "src/components/DetailPane/FileContentViewer.tsx"
      provides: "Container component for file content display"
      min_lines: 50
    - path: "src/components/DetailPane/SyntaxHighlightedContent.tsx"
      provides: "Syntax highlighted code rendering"
      exports: ["SyntaxHighlightedContent"]
    - path: "src/hooks/useFileContent.ts"
      provides: "TanStack Query hook for fetching file content"
      exports: ["useFileContent"]
  key_links:
    - from: "src/components/DetailPane/RevisionDetailView.tsx"
      to: "src/components/DetailPane/FileContentViewer.tsx"
      via: "Component composition - FileContentViewer rendered in RevisionDetailView"
      pattern: "FileContentViewer"
    - from: "src/hooks/useFileContent.ts"
      to: "src/lib/tauri.ts"
      via: "invokeP4PrintContent call in queryFn"
      pattern: "invokeP4PrintContent"
---

<objective>
Create the core FileContentViewer component with syntax highlighting integration.

Purpose: Enable users to view file content at any revision with syntax-appropriate highlighting.
Output: Working file content viewer component integrated into RevisionDetailView.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-file-content-viewer/16-RESEARCH.md
@.planning/phases/16-file-content-viewer/16-01-SUMMARY.md
@src/components/DetailPane/RevisionDetailView.tsx
@src/lib/languageMap.ts
@src/lib/tauri.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useFileContent hook and SyntaxHighlightedContent component</name>
  <files>src/hooks/useFileContent.ts, src/components/DetailPane/SyntaxHighlightedContent.tsx</files>
  <action>
1. Create src/hooks/useFileContent.ts:
   - Use TanStack Query with queryKey ['file-content', depotPath, revision]
   - Call invokeP4PrintContent in queryFn
   - Set staleTime to 60 * 60 * 1000 (1 hour) - file content at specific revision is immutable
   - Accept enabled option for conditional fetching
   - Handle errors gracefully (network, file not found, etc.)

2. Create src/components/DetailPane/SyntaxHighlightedContent.tsx:
   - Import { Highlight, themes } from 'prism-react-renderer'
   - Import getLanguageFromPath from @/lib/languageMap
   - Props: content (string), fileName (string for language detection)
   - Use themes.vsDark for dark theme consistency
   - Render with line numbers in a muted color on the left
   - Use monospace font (font-mono class)
   - Apply overflow-auto for scrolling large files
   - Style line numbers: inline-block, fixed width, right-aligned, select-none, muted color

Reference Pattern 4 from 16-RESEARCH.md for the Highlight component usage.
  </action>
  <verify>
- TypeScript compiles without errors
- useFileContent exports correctly
- SyntaxHighlightedContent renders without errors when given sample code
  </verify>
  <done>Hook fetches file content, component renders syntax-highlighted code with line numbers</done>
</task>

<task type="auto">
  <name>Task 2: Create FileContentViewer and integrate into RevisionDetailView</name>
  <files>src/components/DetailPane/FileContentViewer.tsx, src/components/DetailPane/RevisionDetailView.tsx</files>
  <action>
1. Create src/components/DetailPane/FileContentViewer.tsx:
   - Props: depotPath (string), revision (number)
   - Use useFileContent hook to fetch content
   - Show loading spinner (Loader2 from lucide-react) while loading
   - Show error state with retry button if fetch fails
   - Render SyntaxHighlightedContent when content is loaded
   - Wrap in a container with max-height and overflow for scrolling

2. Update src/components/DetailPane/RevisionDetailView.tsx:
   - Add state: const [showContent, setShowContent] = useState(false)
   - Replace the "Open This Revision" button with "View File Content" toggle button
   - When showContent is true, render FileContentViewer below the action buttons
   - Add "Hide Content" button when content is visible
   - Remove the TODO comment and alert() placeholder
   - Keep all existing functionality (diff buttons, metadata display, sibling files section)

Use Collapsible from @radix-ui/react-collapsible (already in dependencies) for smooth show/hide transition, OR simple conditional rendering.
  </action>
  <verify>
- Navigate to a revision in the app
- Click "View File Content" button
- Verify content loads and displays with syntax highlighting
- Verify "Hide Content" hides the viewer
- Verify diff buttons still work
  </verify>
  <done>FileContentViewer is integrated into RevisionDetailView, user can toggle file content display</done>
</task>

</tasks>

<verification>
1. Navigate to file history in the app
2. Click on a revision row to see revision detail
3. Click "View File Content" button
4. Verify:
   - Loading spinner appears briefly
   - File content displays with syntax highlighting
   - Line numbers show on the left
   - Colors match VS Dark theme
   - Can scroll if content is long
5. Click "Hide Content" to collapse
6. Verify diff buttons still function
</verification>

<success_criteria>
- User can view file content at any revision in detail pane
- File content shows syntax highlighting appropriate for file extension
- Loading state shows while content fetches
- Error state allows retry
- Content can be shown/hidden with toggle button
</success_criteria>

<output>
After completion, create `.planning/phases/16-file-content-viewer/16-02-SUMMARY.md`
</output>
