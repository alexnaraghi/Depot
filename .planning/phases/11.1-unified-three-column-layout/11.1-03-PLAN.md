---
phase: 11.1-unified-three-column-layout
plan: 03
type: execute
wave: 2
depends_on: ["11.1-01"]
files_modified:
  - src/components/DetailPane/ChangelistDetailView.tsx
  - src/components/DetailPane/RevisionDetailView.tsx
  - src/components/DetailPane/DetailPane.tsx
autonomous: true

must_haves:
  truths:
    - "When a changelist is selected, detail pane shows CL description, action buttons, file list, and shelved files"
    - "When a revision is selected, detail pane shows revision metadata, diff actions, and sibling files from that submit"
    - "Clicking a file in CL detail drills into that file's detail view"
    - "Clicking a sibling file in revision detail drills into that file's detail"
  artifacts:
    - path: "src/components/DetailPane/ChangelistDetailView.tsx"
      provides: "CL info, actions, file list, shelved files section"
    - path: "src/components/DetailPane/RevisionDetailView.tsx"
      provides: "Revision info, diff actions, sibling files list"
  key_links:
    - from: "src/components/DetailPane/ChangelistDetailView.tsx"
      to: "src/stores/detailPaneStore.ts"
      via: "drillToFile on file click"
    - from: "src/components/DetailPane/RevisionDetailView.tsx"
      to: "src/hooks/useDiff.ts"
      via: "diffRevisions for Diff vs Previous"
---

<objective>
Build the ChangelistDetailView and RevisionDetailView components for the detail pane.

Purpose: These complete the four detail views needed for the selection-driven center column. CL detail is shown when clicking a CL header, revision detail when clicking a history row.
Output: Two fully functional detail views wired into DetailPane.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/design/unified-column-layout.md
@.planning/phases/11.1-unified-three-column-layout/11.1-01-SUMMARY.md
@src/stores/detailPaneStore.ts
@src/components/ChangelistPanel/ChangelistPanel.tsx
@src/components/dialogs/FileHistoryDialog.tsx
@src/hooks/useDiff.ts
@src/hooks/useShelvedFiles.ts
@src/types/p4.ts
@src/lib/tauri.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ChangelistDetailView</name>
  <files>src/components/DetailPane/ChangelistDetailView.tsx</files>
  <action>
Create the CL detail view following the design doc:

```
CL 4521 - Pending
"Fix crash on disconnect"
---
ACTIONS: [Submit] [Shelve] [Delete] [Edit Description]
---
FILES (3)
  edit  engine.cpp     #42
  edit  render.h       #18
  add   config.json
---
SHELVED FILES (1)
  edit  debug.cpp      #5
```

**Props:** Receive `changelist: P4Changelist` from DetailPane (read from selection store).

**Header section:**
- CL number and status badge (Pending in amber, Submitted in green)
- Description in text-sm, italic if empty ("No description")

**Action buttons:**
- [Submit] — Open SubmitDialog. Import SubmitDialog from ChangelistPanel directory and render it with the selected CL. Use local state `submitDialogOpen`.
- [Shelve] — Use useShelve hook. Only show for numbered CLs with files.
- [Delete] — Use invokeP4DeleteChange. Only show for empty numbered CLs.
- [Edit Description] — Open EditDescriptionDialog. Import from ChangelistPanel directory. Use local state `editDialogOpen`.
- Use Button components with variant="outline" size="sm"

**File list:**
- Iterate over `changelist.files` array
- Show action badge (same color scheme as history: edit=blue, add=green, delete=red), filename, revision
- Each file row is clickable: call `useDetailPaneStore.getState().drillToFile(file.depotPath, file.localPath, changelist.id)` to drill into file detail with CL context
- Hover state on rows

**Shelved files section:**
- Query shelved files using the existing pattern from ShelvedFilesSection.tsx (check `useShelvedFiles` hook or query `['p4', 'shelved', changelist.id]`)
- Only show section if CL has shelved files
- Similar file list layout but with "shelved" indicator

**Important:** Import SubmitDialog and EditDescriptionDialog from `@/components/ChangelistPanel/` — reuse existing dialogs, don't recreate them.
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>ChangelistDetailView shows CL info, action buttons, file list with clickable rows, and shelved files section. Clicking a file drills into FileDetailView.</done>
</task>

<task type="auto">
  <name>Task 2: Create RevisionDetailView and wire all views into DetailPane</name>
  <files>src/components/DetailPane/RevisionDetailView.tsx, src/components/DetailPane/DetailPane.tsx</files>
  <action>
**RevisionDetailView.tsx:**
Create the revision detail view following the design doc:

```
engine.cpp > #42
alice - Jan 30, 2026
"Fix null deref in render loop"
---
ACTIONS: [Diff vs Previous] [Diff vs Workspace] [Open This Revision]
---
FILES IN THIS SUBMIT
  edit  engine.cpp     #42
  edit  render.h       #18
  add   config.json
```

**Props:** Receive `depotPath: string`, `localPath: string`, `revision: P4Revision` from DetailPane.

**Header:**
- Filename extracted from depotPath + revision number
- User, formatted date (from revision.time epoch), description (revision.desc)

**Action buttons:**
- [Diff vs Previous] — Use `useDiff().diffRevisions(depotPath, revision.rev - 1, revision.rev)`. Disable if revision.action is 'add' or 'branch'.
- [Diff vs Workspace] — Use `useDiff().diffAgainstWorkspace(depotPath, localPath, revision.rev)`
- [Open This Revision] — Use Tauri invoke to print revision to temp file, then open it. Use `invokeP4Print` if available in tauri.ts, otherwise add TODO comment.
- Use Button components with variant="outline" size="sm"

**Sibling files section ("Files in this submit"):**
- This requires fetching the changelist details for `revision.change`. The backend does NOT have a general `p4 describe` command — only `p4_describe_shelved` (exposed as `invokeP4DescribeShelved` in tauri.ts) exists, which only returns shelved files.
- **Do NOT attempt to call invokeP4Describe — it does not exist.** Instead, show a static placeholder: `<p className="text-sm text-muted-foreground italic">Sibling files not yet available (needs p4 describe backend)</p>` and add a `// TODO: Add p4_describe command to backend to fetch files in a submitted changelist` comment.
- This is acceptable for the initial implementation. A future phase can add the `p4 describe` backend command.

**Update DetailPane.tsx:**
Replace remaining placeholders:
- `type: 'changelist'` -> `<ChangelistDetailView changelist={selection.changelist} />`
- `type: 'revision'` -> `<RevisionDetailView depotPath={selection.depotPath} localPath={selection.localPath} revision={selection.revision} />`

Add imports for all four views.
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>RevisionDetailView shows revision metadata and diff actions. DetailPane routes all four selection types to their respective views. All detail views support drill-down navigation via the selection store.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. DetailPane correctly renders all four view types based on selection
3. ChangelistDetailView shows CL info with file list
4. RevisionDetailView shows revision info with diff actions
5. File clicks in CL/revision views update selection store
</verification>

<success_criteria>
All four detail views (workspace summary, file detail, CL detail, revision detail) render in the detail pane based on selection type. Navigation between views works through the selection store.
</success_criteria>

<output>
After completion, create `.planning/phases/11.1-unified-three-column-layout/11.1-03-SUMMARY.md`
</output>
