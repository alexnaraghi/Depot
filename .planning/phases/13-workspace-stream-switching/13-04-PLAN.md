---
phase: 13-workspace-stream-switching
plan: 04
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - src/components/Header/ClientSpecDialog.tsx
  - src/components/Header/WorkspaceSwitcher.tsx
autonomous: true

must_haves:
  truths:
    - "User can view client spec in a read-only dialog"
    - "Client spec shows key fields: root, stream, owner, description, options, view mappings"
    - "User can copy field values to clipboard"
  artifacts:
    - path: "src/components/Header/ClientSpecDialog.tsx"
      provides: "Read-only client spec viewer dialog"
  key_links:
    - from: "src/components/Header/ClientSpecDialog.tsx"
      to: "src/lib/tauri.ts"
      via: "invokeP4GetClientSpec"
      pattern: "invokeP4GetClientSpec"
---

<objective>
Create read-only client spec viewer dialog accessible from workspace switcher area.

Purpose: Users can inspect workspace configuration (root, view mappings, options) without terminal.
Output: ClientSpecDialog component triggered from a button near the workspace switcher.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/13-workspace-stream-switching/13-CONTEXT.md
@.planning/phases/13-workspace-stream-switching/13-RESEARCH.md
@.planning/phases/13-workspace-stream-switching/13-01-SUMMARY.md
@src/lib/tauri.ts
@src/components/Header/WorkspaceSwitcher.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ClientSpecDialog component</name>
  <files>src/components/Header/ClientSpecDialog.tsx</files>
  <action>
Create src/components/Header/ClientSpecDialog.tsx:

1. **Dialog** using Radix Dialog (@/components/ui/dialog):
   - DialogTitle: "Client Spec: {workspace}"
   - max-w-2xl, max-h-[80vh] overflow-y-auto
   - Fetches spec on open using invokeP4GetClientSpec(workspace, server, user)

2. **Fields displayed** in a structured layout (space-y-3):
   - **Client**: workspace name
   - **Root**: local root path (with copy button)
   - **Stream**: stream path or "None" (with copy button if present)
   - **Owner**: owner name
   - **Description**: multi-line description text
   - **Options**: options string
   - **Host**: hostname
   - **Submit Options**: submit options string
   - **View**: view mappings in monospace pre block, each line on its own row. Scrollable if long.

3. **Copy button** pattern: Small clipboard icon button (lucide-react Copy icon) next to copyable fields. onClick: navigator.clipboard.writeText(value), show brief toast or change icon to Check for 1.5s.

4. **Loading state**: Show skeleton/spinner while fetching spec.

5. **Error state**: Show error message in dialog if fetch fails.

6. **Props**: open: boolean, onOpenChange: (open: boolean) => void, workspace: string (current workspace name).
  </action>
  <verify>Run `npx tsc --noEmit`</verify>
  <done>ClientSpecDialog renders client spec fields with copy buttons</done>
</task>

<task type="auto">
  <name>Task 2: Add client spec button to workspace area</name>
  <files>src/components/Header/WorkspaceSwitcher.tsx</files>
  <action>
Add a small info/settings icon button next to the WorkspaceSwitcher dropdown that opens ClientSpecDialog:

1. Import ClientSpecDialog
2. Add state: clientSpecOpen (boolean)
3. Add a small button (FileText or Info icon from lucide-react, w-4 h-4) positioned after the Select dropdown
4. Style: text-muted-foreground hover:text-foreground, no border, subtle
5. onClick: setClientSpecOpen(true)
6. Render ClientSpecDialog with open={clientSpecOpen} onOpenChange={setClientSpecOpen} workspace={currentWorkspace}
7. Title tooltip: "View Client Spec"

The button should only render when connected and workspace is set.
  </action>
  <verify>Run `npx tsc --noEmit` and `npm run build`</verify>
  <done>Info button next to workspace dropdown opens client spec dialog</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — compiles
2. `npm run build` — full build succeeds
3. ClientSpecDialog file exists with invokeP4GetClientSpec call
</verification>

<success_criteria>
- Info button visible near workspace dropdown when connected
- Clicking opens dialog showing client spec fields
- Root and Stream fields have working copy buttons
- View mappings display in monospace format
</success_criteria>

<output>
After completion, create `.planning/phases/13-workspace-stream-switching/13-04-SUMMARY.md`
</output>
